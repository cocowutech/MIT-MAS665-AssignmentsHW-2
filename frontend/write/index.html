<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Writing Task</title>
    <!--
    WRITING MODULE FRONTEND DOCUMENTATION
    =====================================
    
    This file implements the frontend interface for the adaptive writing assessment module.
    It provides a complete writing evaluation system with text input, adaptive difficulty,
    and real-time feedback integration with the backend API.
    
    BACKEND API INTEGRATION:
    - POST /auth/token: User authentication
    - POST /write/start: Initialize new writing session
    - POST /write/submit: Submit writing response for evaluation
    - POST /write/next: Get next prompt in current session
    - GET /auth/me: Validate current user token
    
    KEY FEATURES:
    - Adaptive difficulty progression based on performance
    - Text input with word count tracking
    - Writing comprehension assessment
    - Session management with progress tracking
    - Guest user support for testing
    
    BROWSER COMPATIBILITY:
    - Modern browsers with ES2020 support
    - Responsive design for mobile and desktop
    
    WORKFLOW:
    1. User logs in (guest/any for testing)
    2. Starts writing session with initial CEFR level
    3. Reads prompt and writes response
    4. Submits response for evaluation
    5. Receives feedback and adaptive level adjustment
    6. Continues to next prompt or finishes session
    -->
    
    <!-- Shared CSS -->
    <link rel="stylesheet" href="/app/build/shared/css/base.css">
    <link rel="stylesheet" href="/app/build/shared/css/components.css">
    
    <!-- Module-specific CSS -->
    <link rel="stylesheet" href="/app/build/write/styles.css">
    <base href="/app/" />
    
    <!-- Shared JavaScript -->
    <script src="/app/build/shared/js/auth.js?v=20251022"></script>
    <script src="/app/build/shared/js/api.js?v=20251022"></script>
    
    <!-- Module-specific JavaScript -->
    <script src="/app/build/write/write.js?v=20251022"></script>
</head>
<body>
	<div class="container">
        <!-- Header with navigation and auth state -->
        <div class="header">
            <h1>Writing Task</h1>
            <div class="small">
                <a href="/app">Home</a> · 
                <span id="authState">Logged out</span> 
                <a href="/app" id="loginLink">Login</a>
            </div>
		</div>

        <!-- Back navigation card -->
		<div class="card">
			<button onclick="window.location.href = '/app/';">← Back</button>
		</div>

        <div id="status" class="small"></div>

        <!-- Login Form -->
        <div id="login-card" class="card" data-auth-visible="guest">
            <h2>Login</h2>
            <form id="loginForm">
			<div class="row">
				<div>
                        <label for="username">Username</label>
                        <input id="username" type="text" placeholder="username" value="guest" required>
				</div>
				<div>
                        <label for="password">Password</label>
                        <input id="password" type="password" placeholder="password" value="any" required>
				</div>
			</div>
			<div style="margin-top:12px">
                    <button type="submit">Login</button>
                    <span id="loginMsg" class="small" style="margin-left:8px"></span>
			</div>
            </form>
		</div>

        <!-- Main Interface -->
        <div id="session-card" class="hidden" data-auth-visible="user">
            <div class="card">
                <h2>Writing Assessment</h2>
                <p>This assessment will evaluate your writing skills through various prompts and tasks.</p>
                <p>You will be given writing prompts and asked to compose responses. The difficulty will adjust based on your performance.</p>
                
                <div class="writing-level">
                    <span>Starting Level:</span>
                    <span class="level-badge">A2</span>
			</div>
                
                <button id="startBtn">Start Writing Assessment</button>
			</div>
		</div>

        <!-- Assessment Interface -->
        <div id="assessment-interface" class="hidden">
            <!-- Timer Display -->
            <div id="timerCard" class="hidden">
                <div class="timer-widget">
                    <div class="timer-label">Time Remaining</div>
                    <div id="timerValue" class="timer-value">30:00</div>
                    <div id="timerLimit" class="timer-limit">Up to 30 minutes</div>
                </div>
            </div>

            <!-- Progress Display -->
            <div id="progress" class="hidden">
                <!-- Progress will be populated by JavaScript -->
			</div>

            <!-- Writing Prompt -->
            <div id="prompt" class="hidden">
                <!-- Prompt will be populated by JavaScript -->
		</div>

            <!-- Writing Editor -->
            <div id="editor" class="hidden">
                <!-- Editor will be populated by JavaScript -->
		</div>

            <!-- Submit Button -->
            <div class="card" id="submitCard">
                <button id="submitBtn">Submit Writing</button>
	</div>

            <!-- Continue Button -->
            <div class="card hidden next-prompt-card" id="continueCard">
                <div class="next-prompt-content">
                    <div class="next-prompt-text">Ready for another challenge?</div>
                    <button id="continueBtn" class="next-prompt-btn">Next Prompt →</button>
                </div>
                <div class="next-prompt-subtext">We'll load a prompt that matches your latest score.</div>
			</div>
					</div>

        <!-- Results Display -->
        <div id="results" class="hidden">
            <!-- Results will be populated by JavaScript -->
				</div>

    </div>
</body>
</html>
