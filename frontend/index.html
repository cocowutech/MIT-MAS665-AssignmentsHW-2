<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Placement Agent</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; margin: 0; padding: 0; background: #0b1020; color: #f2f4f8; }
		.container { max-width: 820px; margin: 0 auto; padding: 24px; }
		.card { background: #111833; border: 1px solid #1e2a55; border-radius: 12px; padding: 20px; margin-top: 16px; }
		label { display: block; margin: 8px 0 4px; font-size: 14px; color: #c7d2fe; }
		input, textarea { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #e5e7eb; }
		input:focus, textarea:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2); }
		button { background: #2563eb; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; }
		button:hover:not(:disabled) { background: #1d4ed8; transform: translateY(-1px); }
		button:disabled { opacity: 0.6; cursor: not-allowed; }
		.row { display: flex; gap: 12px; align-items: center; }
		.row > * { flex: 1; }
		.header { display: flex; justify-content: space-between; align-items: center; }
		.small { color: #93c5fd; font-size: 12px; }
		pre { white-space: pre-wrap; word-break: break-word; background: #0a0f1f; border: 1px solid #1e2a55; padding: 12px; border-radius: 8px; }
		a { color: #93c5fd; }
		
		/* Authentication Status Styles */
		.auth-status { 
			display: flex; 
			align-items: center; 
			gap: 8px; 
			padding: 8px 12px; 
			border-radius: 6px; 
			font-size: 14px; 
		}
		.auth-status.logged-in { 
			background: rgba(34, 197, 94, 0.1); 
			border: 1px solid rgba(34, 197, 94, 0.3); 
			color: #22c55e; 
		}
		.auth-status.logged-out { 
			background: rgba(239, 68, 68, 0.1); 
			border: 1px solid rgba(239, 68, 68, 0.3); 
			color: #ef4444; 
		}
		.auth-status .status-icon { 
			width: 8px; 
			height: 8px; 
			border-radius: 50%; 
			background: currentColor; 
		}
		
		/* Logout Button Styles */
		#logoutBtn { 
			background: #dc2626; 
			font-size: 12px; 
			padding: 6px 10px; 
			margin-left: 8px; 
		}
		#logoutBtn:hover:not(:disabled) { 
			background: #b91c1c; 
		}
		
		/* Login Form Styles */
		#login-card { 
			border: 2px solid #1e2a55; 
			background: linear-gradient(135deg, #111833 0%, #0f172a 100%); 
		}
		#login-card h3 { 
			margin-top: 0; 
			color: #e5e7eb; 
			font-size: 18px; 
		}
		
		/* Module Cards - Hidden when not authenticated */
		.module-card { 
			transition: opacity 0.3s ease, transform 0.3s ease; 
		}
		.module-card.hidden { 
			opacity: 0.5; 
			transform: scale(0.98); 
			pointer-events: none; 
		}
		
		/* Loading States */
		.loading { 
			opacity: 0.7; 
			pointer-events: none; 
		}
		
		/* Success/Error Messages */
		.message { 
			padding: 8px 12px; 
			border-radius: 6px; 
			font-size: 14px; 
			margin-top: 8px; 
		}
		.message.success { 
			background: rgba(34, 197, 94, 0.1); 
			border: 1px solid rgba(34, 197, 94, 0.3); 
			color: #22c55e; 
		}
		.message.error { 
			background: rgba(239, 68, 68, 0.1); 
			border: 1px solid rgba(239, 68, 68, 0.3); 
			color: #ef4444; 
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h2>Adaptive Placement Agent</h2>
			<div class="small">
				<span id="status">Checking…</span> · 
				<div id="authState" class="auth-status logged-out">
					<span class="status-icon"></span>
					<span>Not logged in</span>
				</div>
				<button id="logoutBtn" style="display:none;">Logout</button>
			</div>
		</div>

		<div class="card" id="login-card">
			<h3>Login</h3>
			<div class="row">
				<div>
					<label>Username</label>
					<input id="username" placeholder="username" value="guest" />
				</div>
				<div>
					<label>Password</label>
					<input id="password" type="password" placeholder="password" value="any" />
				</div>
			</div>
			<div style="margin-top:12px">
				<button id="loginBtn">Login</button>
				<a id="registerLink" href="/register" style="margin-left:8px">Register</a>
				<span id="loginMsg" class="small" style="margin-left:8px"></span>
			</div>
		</div>

		<div class="card" id="gen-card" style="display:none">
			<h3>Personalized Chat</h3>
			
			<!-- ElevenLabs ConvAI Widget -->
			<div id="elevenlabs-widget" style="margin-bottom: 20px;">
				<elevenlabs-convai agent-id="agent_8301k73pseq7e2f8b6x2xs9bwbmr"></elevenlabs-convai>
				<script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
			</div>
			
			<!-- Fallback Gemini Chat -->
			<div id="gemini-chat" style="display:none;">
				<label>Prompt</label>
				<textarea id="prompt" rows="3">Hi there, I am here to talk.</textarea>
				<div style="margin-top:12px">
					<button id="genBtn">Generate</button>
				</div>
				<div style="margin-top:12px">
					<label>Response</label>
					<pre id="out"></pre>
				</div>
			</div>
			
			<!-- Fallback Button -->
			<div style="margin-top:12px">
				<button id="fallbackBtn" onclick="toggleFallback()" style="display:none;">Use Gemini Chat Instead</button>
			</div>
		</div>

		<div class="card module-card" id="reading-module">
			<h3>Reading (Adaptive)</h3>
			<div class="small">3 passages × 5 MCQs, difficulty adapts by the passage results.</div>
			<div style="margin-top:12px">
				<a href="/app/read/" target="_self">Open Reading Module</a>
			</div>
		</div>

		<div class="card module-card" id="vocabulary-module">
			<h3>Vocabulary (Adaptive)</h3>
			<div class="small">15 MCQs, difficulty adapts by streak.</div>
			<div style="margin-top:12px">
				<a href="/app/vocabulary/" target="_self">Open Vocabulary Module</a>
			</div>
		</div>

		<div class="card module-card" id="listening-module">
			<h3>Listening (Adaptive)</h3>
			<div class="small">5 x 2 MCQs, audio comprehension tasks with adaptive difficulty.</div>
			<div style="margin-top:12px">
				<a href="/app/listen/" target="_self">Open Listening Module</a>
			</div>
		</div>

		<div class="card module-card" id="speaking-module">
			<h3>Speaking (Adaptive)</h3>
			<div class="small">15 prompts, difficulty adapts.</div>
			<div style="margin-top:12px">
				<a href="/app/speaking/" target="_self">Open Speaking Module</a>
			</div>
		</div>

		<div class="card module-card" id="writing-module">
			<h3>Writing</h3>
			<div class="small">1 prompt aligned to CEFR band; text or image input; OCR → LLM scoring on content, organization, language control, range; annotated feedback.</div>
			<div style="margin-top:12px">
				<a href="/app/write/" target="_self">Open Writing Module</a>
			</div>
		</div>
	</div>

	<script type="module" src="shared/js/auth.js"></script>
	<script type="module" src="js/main.js"></script>
</body>
</html>