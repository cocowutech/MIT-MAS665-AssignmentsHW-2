<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Listening Module</title>
    
    <!-- 
        Listening Module Frontend Documentation
        =====================================
        
        This file implements the frontend interface for the adaptive listening assessment module.
        It provides a complete listening evaluation system with text-to-speech audio playback,
        multiple choice questions, and real-time feedback integration with the backend API.
        
        KEY FEATURES:
        - Text-to-speech audio playback using Web Speech API
        - Adaptive difficulty progression based on performance
        - Multiple choice questions with immediate feedback
        - Session management with progress tracking
        - Comprehensive results display with vocabulary targets
        
        BROWSER COMPATIBILITY:
        - Requires modern browsers with Web Speech API support
        - Chrome/Firefox recommended for best TTS performance
        - HTTPS required for speech synthesis on non-localhost origins
        
        WORKFLOW:
        1. User logs in (guest/any for testing)
        2. Starts listening session with A2 level
        3. Listens to audio clips and answers questions
        4. Receives immediate feedback and adaptive level adjustment
        5. Continues through 10 questions total
        6. Receives final assessment with recommendations
    -->
    
    <!-- Shared CSS Styles -->
    <link rel="stylesheet" href="../build/shared/css/base.css">
    <link rel="stylesheet" href="../build/shared/css/components.css">
    <link rel="stylesheet" href="../build/listen/styles.css">
</head>
<body>
    <!-- Main application container -->
    <div class="container">
        <!-- Header with navigation and auth state -->
        <div class="header">
            <h2>Listening Module</h2>
            <div class="small">
                <a href="/app">Home</a> · 
                <span id="authState">Logged out</span> 
                <a href="/app" id="loginLink">Login</a>
            </div>
        </div>

        <!-- Back navigation card -->
        <div class="card">
            <button onclick="window.location.href = '/app/';">← Back</button>
        </div>


        <!-- Login form card -->
        <div class="card" id="login-card">
            <h3>Login</h3>
            <form id="loginForm">
            <div class="row">
                <div>
                        <label for="username">Username</label>
                        <input id="username" type="text" placeholder="username" value="guest" required>
                </div>
                <div>
                        <label for="password">Password</label>
                        <input id="password" type="password" placeholder="password" value="any" required>
                </div>
            </div>
            <div style="margin-top:12px">
                    <button type="submit">Login</button>
                <span id="loginMsg" class="small" style="margin-left:8px"></span>
            </div>
            </form>
        </div>

        <!-- Session start card -->
        <div class="card hidden" id="session-card">
            <h3>Start</h3>
            <div class="small" style="margin-bottom: 12px;">
                Starting at CEFR A2 (KET). Difficulty adapts based on your answers.
            </div>
            <div class="row session-row">
                <div>
                    <!-- Level selection removed to force A2 -->
                    <input type="hidden" id="level" value="A2" />
                </div>
                <div>
                    <button id="startBtn">Start Listening Task</button>
                </div>
            </div>
            <div class="small" id="startMsg" style="margin-top:8px"></div>
        </div>

        <!-- Clips and questions card -->
        <div class="card hidden" id="clips-card">
            <h3>Clips & Questions</h3>
            <div id="clipsRoot"></div>
            <div style="margin-top:12px">
                <button id="submitBtn">Submit Answers</button>
                <span id="submitMsg" class="small" style="margin-left:8px"></span>
                <button id="nextClipsBtn" class="hidden" style="margin-left: 8px;" onclick="loadNextClips()">Next</button>
            </div>
            <div id="resultSection" class="hidden" style="margin-top:12px">
                <h3 class="section-title">Result</h3>
                <div id="result"></div>
                <div style="margin-top: 16px;" id="finishSessionBtnContainer" class="hidden">
                    <button onclick="window.location.href = '/app/';">Session finished — back to home</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load shared utilities -->
    <script src="../build/shared/js/auth.js?v=20251022"></script>
    <script src="../build/shared/js/api.js?v=20251022"></script>
    <script src="../build/listen/listen.js?v=20251022"></script>
</body>
</html>